<!DOCTYPE html>
<html lang="sa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="styleSheet" type="text/css" href="style.css">
    <title>वाचस्पत्यम् शब्दकोशः</title>
    
</head>
<body>
    <div class="container">
    <header>
        <h1>वाचस्पत्यम्</h1>
    <p class="small">वाचस्पत्यम् एकः प्रामाणिकः संस्कृतशब्दकोशः अस्ति, यस्मिन् वैदिक–लौकिक–शास्त्रीयशब्दानां अर्थाः, व्युत्पत्तयः प्रयोगाश्च विस्तरेण प्रदत्ताः।
अयं कोशः संस्कृतभाषाया अध्ययन–अनुसन्धानयोः अत्यन्तं विश्वसनीयः आधारग्रन्थः।</p>
    </header>
    <hr>
   
    <div id="searchContainer">
        <input type="text" id="search" placeholder="मृग्यतां शब्दस्तद्व्याख्या वा">
        <div class="search-options">
            <label><input type="radio" name="searchMode" value="wordOnly" checked>शब्दो मृग्यः</label>
            <label><input type="radio" name="searchMode" value="meaningOnly">व्याख्या मृग्या</label>
            <label><input type="radio" name="searchMode" value="both">उभयं मृग्यम्</label>
        </div>
    </div>
    <div class="toggle-btn" id="toggleFilters">
    Filters
    <span class="arrow">▼</span>
 </div>
    <div class="filters" id="filtersPanel">
        <div class="filter-group" id="startingLetterGroup">
            <label>आद्यक्षरानुक्रमेण पृथक्करणम्</label>
            <select id="startingLetterFilter">
                <option value="">सर्वाणि आद्यक्षराणि</option>
            </select>
        </div>

        <div class="filter-group" id="gcGroup">
            <label>लिङ्गशः पृथक्करणम्</label>
            <select id="gcFilter">
                <option value="">सर्वलिङ्गानि</option>
            </select>
        </div>

        <!-- टैग विज़िबिलिटी -->
        <div class="filter-group" style="grid-column: 1 / -1;" id="tagVisibilityGroup">
            <label>दर्शयितुमिष्टानि खण्डानि चिन्वीत</label>
            <div class="tag-visibility" id="tagVisibility">
                <!-- डायनामिकली जनरेट होगा -->
            </div>
        </div>

        <!-- नए टैग फ़िल्टर सेक्शन -->
        <div class="filter-group" style="grid-column: 1 / -1;" id="tagFiltersGroup">
            <label>टैग्-मूल्येन विशिष्टमानानि चीयन्ताम्</label>
            <div class="tag-filters" id="tagFilters">
                <!-- XML से सभी टैग्स के लिए डायनामिक सिलेक्ट बॉक्स जनरेट होंगे -->
            </div>
        </div>
    </div>
    <!-- Custom Divine Sanskrit Loader -->
<div id="divineLoader" class="divine-loader">
    <div class="mandala-outer">
        <div class="mandala-inner">
            <div class="om-symbol">ॐ</div>
            <div class="glow-ring"></div>
            <div class="glow-ring delay1"></div>
            <div class="glow-ring delay2"></div>
        </div>
    </div>
    <div class="loader-text">
        <span>वाचस्पत्यम्</span>
        <div class="shloka">तर्कवाचस्पति पण्डित तारानाथ भट्टाचार्य</div>
    </div>
</div>
    <div id="results"></div>
</div>
    <script>
        
        let dictionary = [];
        let allTags = new Set();
        let filteredEntries = [];
        let tagValues = {}; // { tag: Set of values }
        let startingLetters = new Set();
        let gcValues = new Set();
        let currentPage = 1;
        const itemsPerPage = 5;
        // XML फ़ाइल लोड करना

        // पेज लोड होते ही लोडर दिखाएँ
        document.addEventListener('DOMContentLoaded', () => {
            const loader = document.getElementById('divineLoader');
            if (loader) loader.classList.remove('hidden'); // सुरक्षा के लिए
        });

        fetch('vachaspatyam.xml')
            .then(response => response.text())
            .then(xmlText => {
                const parser = new DOMParser();
                const xml = parser.parseFromString(xmlText, "application/xml");
                const entries = xml.querySelectorAll('entry');

                entries.forEach(entry => {
                    const obj = {};
                    entry.querySelectorAll('*').forEach(child => {
                        const tagName = child.tagName;
                        allTags.add(tagName);

                        if (!obj[tagName]) obj[tagName] = [];
                        const value = child.textContent.trim();
                        if (value) obj[tagName].push(value);

                        // टैग वैल्यूज़ कलेक्ट करना
                        if (!tagValues[tagName]) tagValues[tagName] = new Set();
                        tagValues[tagName].add(value);

                        // विशेष हैंडलिंग
                        if (tagName === 'V' && value) {
                            startingLetters.add(value[0]);
                        }
                        if (tagName === 'GC' && value) {
                            gcValues.add(value);
                        }
                    });
                    dictionary.push(obj);
                });

                generateDynamicFilters();
                generateTagVisibility();
                generateTagFilters(); // नया फ़ीचर
                // renderEntries(dictionary);
                filteredEntries = dictionary;
                currentPage = 1;
                renderPaginatedEntries('');
                // ===== लोडर हटाएँ (डेटा दिखने के बाद) =====
        const loader = document.getElementById('divineLoader');
        if (loader) {
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
            }, 1000); // transition के बाद पूरी तरह हटाएँ
        }
            })
            .catch(err => {
                document.getElementById('results').innerHTML = 
                    '<p class="no-results">vachaspatyam.xml इति संचिका न लब्धा। कृपया तां स्थापयतु।</p>';
                console.error(err);
            });

        function generateDynamicFilters() {
            const startingSelect = document.getElementById('startingLetterFilter');
            [...startingLetters].sort().forEach(letter => {
                const opt = document.createElement('option');
                opt.value = letter;
                opt.textContent = letter;
                startingSelect.appendChild(opt);
            });

            const gcSelect = document.getElementById('gcFilter');
            [...gcValues].sort().forEach(gc => {
                const opt = document.createElement('option');
                opt.value = gc;
                opt.textContent = gc;
                gcSelect.appendChild(opt);
            });
        }

        function generateTagVisibility() {
            const container = document.getElementById('tagVisibility');
            container.innerHTML = '';
            [...allTags].sort().forEach(tag => {
                const label = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = 'show' + tag;
                checkbox.checked = tag === 'V' || tag === 'WM'; // डिफ़ॉल्ट V और WM दिखाएँ
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(' ' + tag));
                container.appendChild(label);
            });
        }

        function generateTagFilters() {
            const container = document.getElementById('tagFilters');
            container.innerHTML = '';
            [...allTags].sort().forEach(tag => {
                if (tag === 'V') return; // V के लिए पहले से आदि अक्षर फ़िल्टर है

                const group = document.createElement('div');
                group.className = 'filter-group';

                const label = document.createElement('label');
                label.textContent = `${tag} मूल्येन पृथक्करोतु`;
                group.appendChild(label);

                const select = document.createElement('select');
                select.id = 'filter_' + tag;
                select.innerHTML = '<option value="">सर्वाणि</option>';

                // टैग के सभी यूनिक वैल्यूज़ जोड़ना
                [...tagValues[tag]].sort().forEach(val => {
                    const opt = document.createElement('option');
                    opt.value = val;
                    opt.textContent = val;
                    select.appendChild(opt);
                });

                group.appendChild(select);
                container.appendChild(group);
            });
        }

        function getMeaningText(entry) {
            let text = '';
            Object.keys(entry).forEach(key => {
                if (key !== 'V') {
                    text += entry[key].join(' ') + ' ';
                }
            });
            return text;
        }

function renderPaginatedEntries(query) {
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = '';

    if (filteredEntries.length === 0) {
        resultsDiv.innerHTML = '<p class="no-results">कश्चन शब्दो न लब्धः। कृपया मृग्यपदं परिवर्तयतु।</p>';
        return;
    }

    // Pagination calculate
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = Math.min(startIndex + itemsPerPage, filteredEntries.length);
    const pageEntries = filteredEntries.slice(startIndex, endIndex);

    // Entries render करना
    pageEntries.forEach(entry => {
        const div = document.createElement('div');
        div.className = 'entry';

        const headWord = entry.V ? highlightText(entry.V[0], query) : 'अज्ञातः';
        div.innerHTML = `<h3>${headWord}</h3>`;

        const tagsDiv = document.createElement('div');

        allTags.forEach(tag => {
            const checkbox = document.getElementById('show' + tag);
            if (checkbox && checkbox.checked && entry[tag]) {
                entry[tag].forEach(value => {
                    const highlightedValue = highlightText(value, query);

                    if (tag === 'WM' || tag === 'EXP') {
                        tagsDiv.innerHTML += `
                            <div class="content">
                                <span class="tag-name">${tag}:</span>
                                ${highlightedValue}
                            </div>`;
                    } else {
                        tagsDiv.innerHTML += `
                            <span class="tag">
                                <span class="tag-name">${tag}:</span>
                                ${highlightedValue}
                            </span>`;
                    }
                });
            }
        });

        div.appendChild(tagsDiv);
        resultsDiv.appendChild(div);
    });

    // Pagination controls जोड़ना
    const paginationDiv = document.createElement('div');
    paginationDiv.className = 'pagination';
    paginationDiv.style.textAlign = 'center';
    paginationDiv.style.marginTop = '30px';

    const totalPages = Math.ceil(filteredEntries.length / itemsPerPage);

    // Previous button
    if (currentPage > 1) {
        const prevBtn = document.createElement('button');
        prevBtn.textContent = '←';
        prevBtn.style.padding = '10px 20px';
        prevBtn.style.margin = '0 10px';
        prevBtn.style.fontSize = '16px';
        prevBtn.onclick = () => {
            currentPage--;
            renderPaginatedEntries(query);
            window.scrollTo(0, 0);
        };
        paginationDiv.appendChild(prevBtn);
    }

    // Page info
    const info = document.createElement('span');
    info.textContent = `पृष्ठ ${currentPage} / ${totalPages} (कुल ${filteredEntries.length} शब्दाः)`;
    info.style.fontSize = '18px';
    info.style.margin = '0 20px';
    paginationDiv.appendChild(info);

    // Next button
    if (currentPage < totalPages) {
        const nextBtn = document.createElement('button');
        nextBtn.textContent = '→';
        nextBtn.style.padding = '10px 2px';
        nextBtn.style.margin = '0 10px';
        nextBtn.style.fontSize = '32px';
        nextBtn.style.fontWeight = '900'
        nextBtn.onclick = () => {
            currentPage++;
            renderPaginatedEntries(query);
            window.scrollTo(0, 0);
        };
        paginationDiv.appendChild(nextBtn);
    }

    resultsDiv.appendChild(paginationDiv);
}

function filterEntries() {
    let filtered = dictionary;

    const query = document.getElementById('search').value.trim();
    const searchMode = document.querySelector('input[name="searchMode"]:checked').value;

    if (query) {
        if (searchMode === 'wordOnly') {
            filtered = filtered.filter(entry => entry.V && entry.V.some(v => v.includes(query)));
        } else if (searchMode === 'meaningOnly') {
            filtered = filtered.filter(entry => getMeaningText(entry).includes(query));
        } else {
            filtered = filtered.filter(entry => 
                (entry.V && entry.V.some(v => v.includes(query))) || 
                getMeaningText(entry).includes(query)
            );
        }
    }

    const startingLetter = document.getElementById('startingLetterFilter').value;
    if (startingLetter) {
        filtered = filtered.filter(entry => entry.V && entry.V[0].startsWith(startingLetter));
    }

    const gc = document.getElementById('gcFilter').value;
    if (gc) {
        filtered = filtered.filter(entry => entry.GC && entry.GC.includes(gc));
    }

    // सभी टैग फ़िल्टर्स
    allTags.forEach(tag => {
        const select = document.getElementById('filter_' + tag);
        if (select && select.value) {
            const filterValue = select.value;
            filtered = filtered.filter(entry => 
                entry[tag] && entry[tag].includes(filterValue)
            );
        }
    });

    // नया: filtered list को global में save करें
    filteredEntries = filtered;
    currentPage = 1;  // नया filter लगने पर पहला page दिखाएँ
    renderPaginatedEntries(query);
}

        // for highlight
            function highlightText(text, query) {
                if (!query) return text;
                const regex = new RegExp(`(${query})`, 'gi');
                return text.replace(regex, '<mark>$1</mark>');
            }

        // टॉगल बटन
    document.getElementById('toggleFilters').addEventListener('click', () => {
    const panel = document.getElementById('filtersPanel');
    const btn = document.getElementById('toggleFilters');
    btn.classList.toggle('active');
    panel.style.display = panel.style.display === 'block' ? 'none' : 'block';

    if (panel.classList.contains('show')) {
        panel.classList.remove('show');
        setTimeout(() => {
            panel.style.display = 'none';
        }, 1); // CSS transition duration के बराबर
    } else {
        panel.style.display = 'grid';
        // थोड़ा सा delay ताकि display apply हो जाए
        requestAnimationFrame(() => {
            panel.classList.add('show');
        });
    }
});


    function generateTagVisibility() {
    const container = document.getElementById('tagVisibility');
    container.innerHTML = '';

    // टैग नेम → संस्कृत में पूरा लेबल (विवरण)
    const tagLabels = {
        V:    "शब्दः (Vocable)",
        GC:   "लिङ्गम् (Grammatical Category)",
        GR:   "व्युत्पत्तिः (Grammar & Root)",
        ET:   "व्युत्पत्ति-विवरणम् (Etymology)",
        EXP:  "व्याख्या (Explanation)",
        CA:   "समास-विश्लेषणम् (Compound Analysis)",
        CT:   "उद्धरणम् (Citation Text)",
        RM:   "सन्दर्भः (Reference Mode)",
        WM:   "मुख्यार्थः (Word Meaning)"
        // यदि भविष्य में नया टैग जोड़ा जाए तो यहाँ उसका विवरण जोड़ सकते हैं
    };

    [...allTags].sort().forEach(tag => {
        const label = document.createElement('label');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = 'show' + tag;
        // डिफ़ॉल्ट: V और WM हमेशा चेक रहें
        checkbox.checked = (tag === 'V' || tag === 'WM');

        label.appendChild(checkbox);
        // विवरण यदि उपलब्ध हो तो दिखाएँ, अन्यथा केवल टैग नेम
        const displayText = tagLabels[tag] || tag;
        label.appendChild(document.createTextNode(' ' + displayText));

        container.appendChild(label);
    });
}



        // सभी इवेंट्स
        document.getElementById('search').addEventListener('input', filterEntries);
        document.querySelectorAll('input[name="searchMode"]').forEach(radio => radio.addEventListener('change', filterEntries));
        document.getElementById('startingLetterFilter').addEventListener('change', filterEntries);
        document.getElementById('gcFilter').addEventListener('change', filterEntries);
        document.getElementById('filtersPanel').addEventListener('change', filterEntries); // सभी सिलेक्ट और चेकबॉक्स

    
    
    
    </script>
</body>
</html>